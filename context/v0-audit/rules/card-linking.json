[
  {"id":"link.staff.authenticated","description":"Staff user must be authenticated to link cards.","facts":["staff.userId"],"operator":"exists","left":"staff.userId","effect":"allow","denyOnFail":true,"source":"src/actions.ts:345-356"},
  {"id":"link.weeks.match.withExceptions","description":"Weeks must match unless Week 5 → Week 6 exception applies.","facts":["physicalCard.weekId","issuedCard.weekId"],"operator":"or","left":{"eq":["physicalCard.weekId","issuedCard.weekId"]},"right":{"and":[{"eq":["physicalCard.weekId","__WEEK5_ID__"]},{"eq":["issuedCard.weekId","__WEEK6_ID__"]}]},"effect":"allow","denyOnFail":true,"source":"src/actions.ts:423-441"},
  {"id":"link.locations.match","description":"Locations must match if physical card has a location.","facts":["physicalCard.locationId","issuedCard.locationId"],"operator":"implies","left":{"isString":"physicalCard.locationId"},"right":{"eq":["physicalCard.locationId","issuedCard.locationId"]},"effect":"allow","denyOnFail":true,"source":"src/actions.ts:451-460"},
  {"id":"link.tiers.match.withExceptions","description":"Card tiers must match unless (both Week 5) or (Week5→Week6) exception applies.","facts":["physicalCard.cardTierId","issuedCard.cardTierId","physicalCard.weekId","issuedCard.weekId"],"operator":"or","left":{"eq":["physicalCard.cardTierId","issuedCard.cardTierId"]},"right":{"or":[{"and":[{"eq":["physicalCard.weekId","__WEEK5_ID__"]},{"eq":["issuedCard.weekId","__WEEK5_ID__"]}]},{"and":[{"eq":["physicalCard.weekId","__WEEK5_ID__"]},{"eq":["issuedCard.weekId","__WEEK6_ID__"]}]}]},"effect":"allow","denyOnFail":true,"source":"src/actions.ts:463-473"},
  {"id":"link.uniqueness.1to1","description":"A physical card and issued card can only be linked once (schema uniqueness).","facts":["linkedCards.physicalCardId","linkedCards.issuedCardId"],"operator":"unique","effect":"allow","denyOnFail":true,"source":"src/schema.ts:154-171"}
]

